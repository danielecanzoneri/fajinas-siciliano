<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fajinas Siciliano</title>
  <style>
    body {
      font-family: "Poppins", Arial, sans-serif;
      background-color: #fff3e0;
      color: #333;
      text-align: center;
      margin: 0;
      padding: 0 10px;
    }

    h1 {
      margin-top: 20px;
      color: #bf360c;
      font-size: 2em;
    }

    #controls {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    #add-player,
    #sort-players,
    #confirm-hand {
      padding: 12px 18px;
      background-color: #ff7043;
      border: none;
      color: white;
      font-size: 1em;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 200px;
    }

    #add-player:hover,
    #sort-players:hover,
    #confirm-hand:hover {
      background-color: #e64a19;
    }

    #confirm-hand {
      background-color: #4caf50;
    }

    #confirm-hand:hover {
      background-color: #388e3c;
    }

    #confirm-hand:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    #player-list {
      max-width: 480px;
      margin: 0 auto;
      text-align: left;
    }

    .player {
      background: #ffffff;
      border-radius: 12px;
      padding: 10px 12px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      gap: 8px;
    }

    .left-section {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .delete-btn {
      background-color: #d32f2f;
      border: none;
      color: white;
      font-weight: bold;
      font-size: 0.8em;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
    }

    .delete-btn:hover {
      background-color: #b71c1c;
      transform: scale(1.1);
    }

    .player-name {
      font-weight: bold;
      font-size: 1.3em;
      min-width: 80px;
    }
    .score-section {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
    }

    .score {
      font-size: 1.3em;
      width: 60px;
      text-align: center;
      cursor: pointer;
      border-radius: 6px;
      padding: 5px 0;
      background-color: #ffe0b2;
      transition: background-color 0.2s;
    }

    .score:hover {
      background-color: #ffd180;
    }

    .temp-score {
      font-size: 1em;
      color: #ff7043;
      font-weight: bold;
      min-width: 35px;
      text-align: left;
    }

    .buttons {
      display: flex;
      gap: 6px;
    }

    button.score-btn {
      background-color: #ff7043;
      border: none;
      color: white;
      font-size: 0.9em;
      border-radius: 10px;
      width: 50px;
      height: 35px;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
    }

    button.score-btn:hover {
      background-color: #e64a19;
      transform: scale(1.05);
    }

    button.score-btn:disabled {
      background-color: #e64a19;
      cursor: not-allowed;
      opacity: 0.5;
    }

    button.score-btn:disabled:hover {
      transform: none;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.6em;
      }

      #add-player,
      #sort-players {
        width: 90%;
      }

      .player {
        flex-wrap: nowrap;
      }

      .player-name {
        font-size: 1.1em;
      }

      .score {
        width: 50px;
        font-size: 1.1em;
      }
    }
  </style>
</head>
<body>
  <h1>üÉè Fajinas Siciliano</h1>
  <div id="controls">
    <button id="add-player">‚ûï Aggiungi Giocatore</button>
    <button id="sort-players">üèÜ Calcola Classifica</button>
  </div>
  <div id="player-list"></div>
  
  <div id="confirm-section" style="display: none; text-align: center; margin: 20px 0;">
    <button id="confirm-hand" disabled>‚úÖ Conferma punteggi</button>
  </div>

  <script>
    const playerList = document.getElementById("player-list");
    const addPlayerBtn = document.getElementById("add-player");
    const sortPlayersBtn = document.getElementById("sort-players");
    const confirmHandBtn = document.getElementById("confirm-hand");

    let players = [];
    let tempScores = {}; // Punteggi temporanei per la mano corrente
    let usedPlus10 = {}; // Traccia chi ha gi√† usato +10 nella mano corrente

    addPlayerBtn.addEventListener("click", () => {
      const name = prompt("Nome del giocatore:");
      if (name && name.trim() !== "") {
        if (players.some(p => p.name.toLowerCase() === name.trim().toLowerCase())) {
          alert("Questo nome esiste gi√†!");
          return;
        }
        players.push({ name: name.trim(), score: 0 });
        renderPlayers();
      }
    });

    sortPlayersBtn.addEventListener("click", () => {
      players.sort((a, b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.name.localeCompare(b.name, "it", { sensitivity: "base" });
      });
      renderPlayers();
    });

    confirmHandBtn.addEventListener("click", () => {
      // Conferma i punteggi temporanei
      players.forEach(player => {
        if (tempScores[player.name]) {
          player.score += tempScores[player.name];
        }
      });
      
      // Resetta i punteggi temporanei e l'uso del +10
      tempScores = {};
      usedPlus10 = {};
      confirmHandBtn.disabled = true;
      renderPlayers();
    });
    
    function updateConfirmButton() {
      const confirmSection = document.getElementById("confirm-section");

      // Mostra la sezione solo se ci sono giocatori
      if (players.length > 0) {
        confirmSection.style.display = "block";

        // Abilita il pulsante "Conferma" solo se ci sono punteggi temporanei
        const hasTempScores = Object.values(tempScores).some(score => score > 0);
        confirmHandBtn.disabled = !hasTempScores;
      } else {
        confirmSection.style.display = "none";
      }
    }

    function renderPlayers() {
      playerList.innerHTML = "";
      players.forEach((player) => {
        const playerDiv = document.createElement("div");
        playerDiv.className = "player";

        const leftSection = document.createElement("div");
        leftSection.className = "left-section";

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "‚úñ";
        deleteBtn.className = "delete-btn";
        deleteBtn.title = "Elimina giocatore";
        deleteBtn.addEventListener("click", () => {
          if (confirm(`Vuoi davvero eliminare ${player.name}?`)) {
            players = players.filter((p) => p !== player);
            delete tempScores[player.name];
            delete usedPlus10[player.name];
            updateConfirmButton();
            renderPlayers();
          }
        });

        const playerName = document.createElement("span");
        playerName.className = "player-name";
        playerName.textContent = player.name;

        leftSection.appendChild(deleteBtn);
        leftSection.appendChild(playerName);
        
        const scoreSection = document.createElement("div");
        scoreSection.className = "score-section";

        const score = document.createElement("span");
        score.className = "score";
        score.textContent = player.score;
        score.title = "Tocca per modificare il punteggio";

        score.addEventListener("click", () => {
          const newScore = prompt(
            `Inserisci il nuovo punteggio per ${player.name}:`,
            player.score
          );
          if (newScore !== null && !isNaN(parseInt(newScore))) {
            player.score = parseInt(newScore);
            renderPlayers();
          }
        });

        const tempScore = document.createElement("div");
        tempScore.className = "temp-score";
        tempScore.textContent = tempScores[player.name] ? `+${tempScores[player.name]}` : "";

        scoreSection.appendChild(tempScore);
        scoreSection.appendChild(score);

        const buttonsDiv = document.createElement("div");
        buttonsDiv.className = "buttons";
         
        const plus3Btn = document.createElement("button");
        plus3Btn.textContent = "+3";
        plus3Btn.className = "score-btn";
        plus3Btn.addEventListener("click", () => {
          tempScores[player.name] = (tempScores[player.name] || 0) + 3;
          updateConfirmButton();
          renderPlayers();
        });
         
        const plus10Btn = document.createElement("button");
        plus10Btn.textContent = "+10";
        plus10Btn.className = "score-btn";
        
        // Disabilita il pulsante se il giocatore ha gi√† usato +10 in questa mano
        if (usedPlus10[player.name]) {
          plus10Btn.disabled = true;
        }
        
        plus10Btn.addEventListener("click", () => {
          if (!usedPlus10[player.name]) {
            tempScores[player.name] = (tempScores[player.name] || 0) + 10;
            usedPlus10[player.name] = true;
            updateConfirmButton();
            renderPlayers();
          }
        });

        buttonsDiv.appendChild(plus3Btn);
        buttonsDiv.appendChild(plus10Btn);

        playerDiv.appendChild(leftSection);
        playerDiv.appendChild(scoreSection);
        playerDiv.appendChild(buttonsDiv);

        playerList.appendChild(playerDiv);
      });

      // Aggiorna la visibilit√† del pulsante conferma
      updateConfirmButton();
    }
  </script>
</body>
</html>
